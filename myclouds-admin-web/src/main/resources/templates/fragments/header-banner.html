<!-- Start: Header -->
<!--++++++++++++++++++++++++++++++++++++++ 
       ".navbar" Helper Classes: 
    ++++++++++++++++++++++++++++++++++++++++ 
       * Positioning Classes: 
        '.navbar-static-top' - Static top positioned navbar
        '.navbar-static-top' - Fixed top positioned navbar

       * Available Skin Classes:
         .bg-dark    .bg-primary   .bg-success   
         .bg-info    .bg-warning   .bg-danger
         .bg-alert   .bg-system 
    ++++++++++++++++++++++++++++++++++++++++
      Example: <header class="navbar navbar-fixed-top bg-primary">
      Results : Fixed top navbar with blue background 
    ++++++++++++++++++++++++++++++++++++++-->
<header class="navbar navbar-fixed-top" th:fragment="banner">
	<div class="navbar-branding">
		<a class="navbar-brand" href="/">
			<span class="navbar-logo fs26" th:text="${@thCxt.param('sys_logo_name')}"></span>
		</a>
		<span id="toggle_sidemenu_l" class="ad ad-lines"></span>
	</div>
	<ul class="nav navbar-nav navbar-left">
		<li class="hidden-xs">
			<a class="request-fullscreen toggle-active" href="#">
				<span class="ad ad-screen-full fs18"></span>
			</a>
		</li>
	</ul>
	<form class="navbar-form navbar-left navbar-search" role="search">
		<div class="form-group">
			<input type="text" class="form-control" placeholder="搜索..." />
		</div>
	</form>
	<ul class="nav navbar-nav navbar-right">

		<!--  
		<li class="dropdown">
			<a class="dropdown-toggle" data-toggle="dropdown" href="#">
				<span class="ad ad-radio-tower fs18"></span>
			</a>
			<ul class="dropdown-menu media-list w350 animated animated-shorter fadeIn" role="menu">
				<li class="dropdown-header">
					<span class="dropdown-title"> 站内消息</span> <span class="label label-xs label-warning">12</span>
				</li>
				<li class="media">
					<a class="media-left" href="#">
						<img src="/theme/assets/img/avatars/2.jpg" class="mw40" />
					</a>
					<div class="media-body">
						<h5 class="media-heading">
							支付通道临时关闭 <span class="label label-xs label-warning">未读</span>
						</h5>
						2017/6/22 by 阿黑哥
					</div>
				</li>
				<li class="media">
					<a class="media-left" href="#">
						<img src="/theme/assets/img/avatars/2.jpg" class="mw40" alt="用户头像" />
					</a>
					<div class="media-body">
						<h5 class="media-heading mv5">国庆节放假银行系统维护值班通知</h5>
						2017/10/22 by 阿黑哥
					</div>
				</li>
				<li class="media">
					<a class="media-left" href="#">
						<img src="/theme/assets/img/avatars/3.jpg" class="mw40" alt="用户头像" />
					</a>
					<div class="media-body">
						<h5 class="media-heading">系统升级维护</h5>
						2017/12/22 by 阿黑哥
					</div>
				</li>
			</ul>
		</li>
		-->

		<li class="dropdown">
			<a href="#" class="dropdown-toggle p10" data-toggle="dropdown">
				<img src="/theme/assets/img/avatars/avatar.png" class="mw40 br24 mr5" />
				<span th:text="${session._user?.name}"></span> <span class="caret caret-tp hidden-xs"></span>
			</a>
			<ul class="dropdown-menu list-group dropdown-persist w250 animated animated-short fadeIn" role="menu">
				<li class="list-group-item">
					<a href="#" onclick="fnOpenPwd();">
						<span class="fa fa-key"></span> 修改密码
					</a>
				</li>
				<li class="list-group-item">
					<a href="#" onclick="fnLogout();">
						<span class="fa fa-power-off pr5"></span> 安全退出
					</a>
				</li>
			</ul>
		</li>
	</ul>
</header>
<!-- End: Header -->

<!-- Start: Update PWD Window -->
<!-- 修改密码窗口 -->
<div class="modal fade" id="w-pwd" tabindex="-1" data-backdrop="static">
	<div class="modal-dialog w450">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h3 class="modal-title">修改密码</h3>
			</div>
			<div class="modal-body">
				<form id="fo-pwd" class="form-horizontal">
					<input type="hidden" name="id" th:value="${session._user?.id}" />
					<div class="form-group">
						<label class="col-md-3 control-label">登录账号：</label>
						<div class="col-md-9 field">
							<input type="text" name="account" class="form-control" readonly="readonly" th:value="${session._user?.account}" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-3 control-label required">原密码：</label>
						<div class="col-md-9 field">
							<input type="password" name="password" class="form-control" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-3 control-label required">新密码：</label>
						<div class="col-md-9 field">
							<input type="password" name="new_password" class="form-control" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-3 control-label required">确认密码：</label>
						<div class="col-md-9 field">
							<input type="password" name="confirm_password" class="form-control" />
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="submit" form="fo-pwd" class="btn btn-sm btn-success btn-gradient">保存</button>
				<button type="button" class="btn btn-sm btn-danger btn-gradient" data-dismiss="modal">关闭</button>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<!-- End: Update PWD Window -->

<!--Start：ERROR Window -->
<div class="modal fade" id="w-global-error" tabindex="-1" data-backdrop="static">
	<div class="modal-dialog w700">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h3 class="modal-title">系统错误 <small>请和管理员联系</small></h3>
			</div>
			<div class="modal-body">
				<form id="fo-global-error" class="form-horizontal">
					<div class="form-group">
						<label class="col-md-2 control-label">请求路径：</label>
						<div class="col-md-6 field">
							<p class="form-control-static" id="id-error-path"><span class="label label-rounded label-danger"></span></p>
						</div>
						<label class="col-md-2 control-label">HTTP响应码：</label>
						<div class="col-md-2 field">
							<p class="form-control-static" id="id-error-status"><span class="label label-rounded label-danger"></span></p>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label">异常类：</label>
						<div class="col-md-10 field">
							<p class="form-control-static text-danger" id="id-error-exception"><span class="label label-rounded label-danger"></span></p>
						</div>
					</div>
					<div class="form-group">
						<label class="col-md-2 control-label">摘要信息：</label>
						<div class="col-md-10 field">
							<p class="form-control-static text-danger fs14" id="id-error-message"></p>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-sm btn-danger btn-gradient" data-dismiss="modal">关闭</button>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<!--End：ERROR Window -->


<!-- Start: Header Script -->
<script type="text/javascript">
	//注销
	function fnLogout() {
		My.confirm('确认安全退出系统吗？', function(result) {
			if (result) {
				$.ajax({
					type : 'post',
					url : '/logout',
					success : function(data) {
						window.location.href = '/login';
					}
				});
			}
		});
	}

	//修改密码
	function fnUpdatePwd() {
		var data = My.params('#fo-pwd');
		data.password = hex_md5(data.password);
		data.new_password = hex_md5(data.new_password);
		data.confirm_password = hex_md5(data.confirm_password);
		$.ajax({
			type : 'post',
			url : '/sys/user/updatePwd',
			data : data,
			success : function(data) {
				if (data.code == '1') {
					$('#w-pwd').modal('hide');
					My.confirm('密码修改成功，需要退出并重新登录吗？', function(result) {
						if (result) {
							$.ajax({
								type : 'post',
								url : '/logout',
								success : function(data) {
									window.location.href = '/login';
								}
							});
						}
					});
				} else {
					My.notify(data.msg, 'danger');
				}
			}
		});
	}

	//打开密码修改窗口
	function fnOpenPwd() {
		$('#w-pwd').modal();
		$("#fo-pwd")[0].reset();
	}

	$(function() {
		//表单校验规则
		var validatePwd = {
			//校验规则
			rules : {
				password : {
					required : true
				},
				new_password : {
					required : true
				},
				confirm_password : {
					required : true
				}
			},
			//提示信息
			messages : {
				password : {
					required : '请输入原密码'
				},
				new_password : {
					required : '请输入新密码'
				},
				confirm_password : {
					required : '请输入确认密码'
				}
			}
		}

		//绑定新增表单校验和提交响应事件
		My.validate('#fo-pwd', fnUpdatePwd, validatePwd);

	});
</script>
<!-- End: Header Script -->